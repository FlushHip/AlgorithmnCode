# 数据结构

- KMP算法，`next`数组：**对应位置前缀和后缀的最长公共部分长度**
- 多路归并排序
- 图的基本概念
- 最短路径，最小生成树的生成过程
- 哈希冲突解决方法
- B树，B+树的概念及操作
- 平衡二叉树的旋转

# 计算机组成原理

## 基本概念

- 计算机性能

- |                           机器字长                           |                           存储字长                           |      指令字长      |
  | :----------------------------------------------------------: | :----------------------------------------------------------: | :----------------: |
  | CPU一次能处理的最多位数据长度，通常与CPU的通用寄存器位数有关 | 存储器中一个存储单元(存储地址)所存储的二进制代码的位数，即存储器中的MDR的位数 | 计算机指令字的位数 |

- $$
  2^{15}=32768,2^{16}=65536
  $$

- FLOPS，`K->M->G->T->P->E->Z`

## 数据表示与运算

- 原码，补码，移码比较

- IEEE754浮点数格式， float，double，浮点数范围，浮点数表示

  - float 8 位阶码，double 11 位阶码

  - $$
    1.m*2^{M-127},M\in[0, 255]
    $$

  - 阶码全0表示无穷小(**-127**)，全1表示无穷大(**128**)，因此阶码范围`[-126, 127]`

  - 绝对值最小规约数
    $$
    \pm 1.0*2^{-126}
    $$
    
  - 绝对值最大规约数
  
  $$
  \pm (2-2^{-23})*2^{127}
  $$
  
  - NaN：指数全一，尾数非全零
  
- 浮点数加法

  1. 对阶，`small -> big`
  2. 尾数相加
  3. 尾数规格化
     - 左归，阶码减少，不可能溢出
     - 右归，阶码增加，有可能溢出
  4. 舍入
  5. 溢出判断
     - 上溢，异常，中断
     - 下溢，机器零处理

- 两个无符号数相加OF可能为1（溢出），相减CF可能为1（小-大，借位）

- 定点补码溢出判断（机器级判断）
  - 单符号：操作数符号相同，结果符号与操作数符号不同
  - 双符号：双符号位符号不同表示溢出，且最高符号位表示最终运算结果符号

## 存储系统

- SRAM，DRAM，ROM，随机，只读

  - SRAM：双稳态触发器
  - DRAM：电容，需要刷新
  - ROM：Flash，常用于U盘，固态硬盘，写入前得先擦除

- 主存与CPU的连接，特别是DRAM片选时，行列地址线复用

- 双端RAM

- Cache替换策略LRU算法需要加额外的位
  $$
  log_2n
  $$

## 指令系统

- 寻址方式，**间址扩大寻址范围**

  - 立即寻址（操作数），直接寻址（地址）
  - 寄存器间接寻址，存储器间接寻址
  - 基址寻址（程序段），变址寻址（数组）
  - 相对寻址，注意取指后PC会+1，偏移位置的计算
  - 堆栈寻址，参数传递

- |      区别      |     CISC     |               RISC               |
  | :------------: | :----------: | :------------------------------: |
  |    指令系统    |     复杂     |               简单               |
  |    指令数目    |      多      |                少                |
  |    指令字长    |    不固定    |               固定               |
  |    控制方式    |    微程序    |           组合逻辑电路           |
  | 通用寄存器数量 |      少      |                多                |
  |    目标代码    | 难以编译优化 |       可以编译优化，效率高       |
  | 各指令执行时间 |   相差较大   | 有指令流水线，多在一个时钟周期内 |

## CPU

- 运算器构成元素
  - ALU
  - 累加寄存器
  - 通用寄存器
  - PSW
  - 暂存寄存器
  
- 控制器构成元素
  - PC
  - IR
  - MAR
  - MDR
  - 指令译码器
  
- 用户可见寄存器
  - 通用寄存器
  - PC
  - ACC
  - PSW
  
- **指令周期**包含若干**机器周期**，机器周期包含若干**时钟周期**

- 控制存储器（ROM）

- 微指令的编码方式

  - **直接编码**，长度长`n`
  - **字段直接编码**：互斥指令归一类，长度短`log (n + 1)`，需要译码
  - 字段间接编码

- | 水平微指令 | 垂直微指令 |
  | :--------: | :--------: |
  |            |            |

- 指令流水线

  - 超标量流水线
  - 超流水线

- 流水线阻塞因素

  - 结构相关：竞争同一资源导致，解决：
    - 指令和数据分离
    - 延后时钟周期
  - 数据相关：同步问题，解决：
    - 延后时钟周期
    - 数据旁路
  - 控制相关：跳转指令，解决：
    - 分支预测
    - 指令预取

## 总线

- 总线分类（按功能划分）
  - 片内总线：CPU内部
  - 系统总线：计算机系统内
  - 通信总线：计算机之间
- 总线两种定时方式
  - 同步通信：统一时钟信号管理
  - 异步通信：”握手“，”应答“。常用于通信双方速度差异较大的设备之间
    - 不互锁：啥也不管
    - 半互锁：半双工
    - 全互锁：三次握手
- 总线性能指标
  - 总线时钟周期：机器时钟周期
  - 总线时钟频率：总线时钟周期的倒数
  - 总线工作周期：一次总线操作需要多少个总线时钟周期
  - 总线工作频率：总线工作周期的倒数
- 总线复用：地址/信号线复用
- 总线标准（趋势：串行总线代替并行总线）
  - 系统总线，FBS，QPI（串行总线，Intel提出）
  - 局部总线，PCI（并行总线），PCI-E（串行总线）
  - 设备总线
    - 并行总线：SCSI，IDE
    - 串行总线：USB，SATA

## I/O系统

- RAID
  - RAID**0**：内容分开存
  - RAID**1**：内容冗余存
  - RAID**2**：海明码校验纠错
  - RAID**3~5**：奇偶校验
- I/O接口，设备中断码传递通过数据总线，CPU检测中断信号通过控制总线，I/O接口有很多I/O端口
- I/O接口中的控制寄存器和状态寄存器可以复用
- 中断处理过程
  - 中断向量，中断向量地址，硬件产生向量地址，由向量地址找到向量
  - 中断隐指令
    - 关中断
    - 保存断点（PC，PSW）
    - 找到中断服务程序
  - 保存现场*（和 PSW（多重中断））*
  - 中断服务程序
  - *关中断（多重中断）*
  - 恢复现场*（和 PSW（多重中断））*
  - 开中断
  - 中断最后一条指令为返回指令
- 中断到来顺序和中断响应顺序没有关系，中断响应顺序根据硬件排队器和中断屏蔽字实现
- 中断检查发生在每条指令执行末端，也就是中断周期内检查。所以外中断有延时，而异常没有延时
- DMA
  - 一次DMA请求对应与总线的使用权争夺，一次DMA请求传送一个字的数据，一次DMA传送操作中对应多次DMA请求

# 操作系统

## 操作系统发展历程

## 进程管理

- 进程状态转换

  - 进程创建就通过**原语**完成，**PCB**大小和内存容量决定进程创建数量
  - 进程阻塞是主动行为，进程唤醒是被动行为

- 处理机调度

  - 高级调度：作业调度
  - 中级调度：挂起，激活
  - 低级调度：进程调度

- 调度指标

  - 周转时间：作业完成时间-作业提交时间
  - 平均周转时间
  - 带权周转时间：作业周转时间/作业实际运行时间
  - 平均带权周转时间
  - 等待时间
  - 响应时间：从用户提交作业到首次响应的时间

- 进程调度优先级

  - 系统高于用户
  - 前台高于后台
  - I/O高于CPU

- 作业调度算法

- |       算法       |                        备注                         |                           特点                           |
  | :--------------: | :-------------------------------------------------: | :------------------------------------------------------: |
  |    先来先服务    |                                                     |                利于长作业和CPU繁忙型作业                 |
  |      短优先      |                                                     |    不利于长作业；<br />平均等待时间，平均周转时间最小    |
  |     高响应比     | `响应比 = (等待时间 + 要求服务时间) / 要求服务时间` | 利于短作业；<br />等待时间越长，优先级越高；<br />好算法 |
  |    时间片轮转    |                                                     |                   时间片大小选择要适中                   |
  | 多级反馈队列调度 |  设置多个就绪队列，时间片大小递增；<br />抢占算法   |                          好算法                          |

- 进程同步互斥原则

  - 空闲让进
  - 忙则等待
  - 有限等待
  - 让权等待

- 互斥软件实现方法

  - 单标志法，特点：确保进程互斥访问临界区；两个进程必须交替进入临界区
  - 双标志先检查法，特点：进程不必交替进入，但是不能保证互斥访问
  - 双标志后检查法，特点：确保进程互斥访问临界区，但是会发生饥饿现象
  - 皮特森算法，特点：单标志法和双标志后检查法的结合，其中**单标志表示优先哪个进程进入临界区**（谦让），特点：效果好，互斥且不饥饿
  
- 皮特森算法不满足让权等待原则，信号量机制也不满足让权等待原则，记录型信号量机制满足让权等待原则

- 生产者-消费者问题：生产者和消费者是互斥关系，生产者和生产者或消费者和消费者是同步关系

- 读写问题，写写和读写互斥，读读不互斥

  - 设置读进程数`count`变量，同时还要设置`mutex`保护`count`
  - 为写互斥单独设置`mutex`
  - *写饥饿的处理：设置写优先互斥变量*

- 哲学家进餐问题

  - 用`lock`同时锁左右
  - 用互斥量同时锁左右

- 死锁条件

  - 互斥
  - 不剥夺
  - 请求保持
  - 循环等待

- 死锁解决

  - 预防死锁：破坏死锁条件
  - 避免死锁：防止系统进入**不安全状态**
  - 死锁检测和解除，允许死锁发生，不过可以检查出来且可以解除

## 内存管理

- 连续分配方式
  - 单一连续分配
  - 固定分区分配
  - 动态分区分配
- 动态分区分配算法
  - 首次适应
  - 循环首次适应
  - 最近适应
  - 最差适应
- 虚拟存储器的容量取决于地址空间的大小
- 页面分配策略
  - 固定
    - 局部
  - 可变
    - 全局
    - 局部
- 抖动，颠簸，原因：对换过多，内存不足，置换算法不当

## 文件管理

- 逻辑文件，有结构文件，顺序文件，索引文件，索引顺序文件
- 物理结构，顺序存储，显式链式存储，隐式链式存储，索引存储（i节点）
- 相对路径有利于加快检索速度
- 文件控制块FCB：存放控制文件需要的各种信息的数据结构，FCB的有序集合就是目录，一个目录项就是一个FCB
- 文件打开，需要路径，返回句柄，之后的所有读写删除都是利用这个句柄进行操作
- 磁盘调度寻道算法
  - 先来先服务（公平算法）
  - 最短寻道优先
  - 电梯算法（扫描算法）
  - 循环扫描算法
  - **改进**的电梯算法，循环扫描算法

## I/O管理

- I/O层次
  - 用户层（库函数）
  - 设备独立层（系统调用，设备分配和回收）
  - 驱动（抽象转具体，型号上报）
  - 中断（进程上下文切换，中断信号源测试，读取设备状态）
  - 设备控制器（硬件）
- DMA
- 通道
- 缓冲
  - 单缓冲
  - 双缓冲

# 计算机网络

## 前置知识

- 协议模型，ISO，TCP/IP

  - |  差异  |       ISO       |     TCP/IP      |
    | :----: | :-------------: | :-------------: |
    | 网络层 | 无连接+面向连接 |     无连接      |
    | 传输层 |    面向连接     | 无连接+面向连接 |

- 码元：离散状态，波特率：码元速率

- 公式

  - 奈奎斯特定理：无噪声极限速率
    $$
    2Wlog_2M
    $$

  - 香农定理：有噪声极限上限速率
    $$
    Wlog_2(1 + \frac{S}{N}) \\ dB = 10log_{10}\frac{S}{N}
    $$

  - 两公式都可用
    $$
    min\{奈奎斯特，香农\}
    $$

- 编码，曼切斯特编码，差分曼切斯特编码（同1异0，与前一码元比较）

- 编码过程（典型例子，PCM）

  - 采样
  - 量化
  - 编码

- 调制

  - 调幅
  - 调频
  - 调相

- 分组交换

  |    差异    | 数据报 | 虚电路 |
  | :--------: | :----: | :----: |
  | 连接的建立 |  需要  | 不需要 |
  |  分组顺序  | 不保证 |  保证  |

- 物理接口特性

  - 机械特性
  - 电气特性：电压，电相关的东西
  - 功能特性：电平，信号线（数据线，控制线）用途
  - 过程特性：时序

## 数据链路层

- 零比特填充法：五个连续的1插入一个0

- 奇偶校验码，添加冗余位后1的个数定奇偶

- 循环冗余码CRC：多项式除多项式

- 海明码

  - 检错`d`位，码距`d + 1`；纠错`d`位，码距`2d + 1`

  - 数据位`m`，冗余位`r`，满足
    $$
    2^r \ge m + r + 1
    $$

- 

- 争用期，经典公式
$$
信道利用率 = \frac{\frac{L_{数据}}{v_发}}{\frac{L_{确认帧}}{v_发}+\frac{L_{数据}}{v_发}+2\tau}
$$

- 后退N帧（GBN）协议

  - 接收方可累计确认（捎带确认），`ACK`n表示对n号及以前的帧全部正确收到，且期待接受n+1号帧

  - 发送窗口
    $$
    1 \le W_T\le2^n-1
    $$

  - 接受窗口：1

- 选择重传（SR）协议，滑动窗口

  - 接收方对每一帧逐一确认

  - 发送窗口和接受窗口
    $$
    W_T + W_R \le 2^{n}\\ mostly \quad\quad\quad W_R=W_T=2^{n-1}
    $$

- 静态划分信道

  - FDM，TDM，WDM
  -  码分多路复用（CDMA）

- 动态划分信道

  - CSMA（载波监听多点接入）

    |          | 1-坚持CSMA |            非坚持CSMA            |              p-坚持CSMA              |
    | :------: | :--------: | :------------------------------: | :----------------------------------: |
    | 信道空闲 |   马上发   |              马上发              | p概率马上发<br />1-p概率等下一时隙发 |
    |  信道忙  |  坚持监听  | 放弃监听，等待一个随机时间再监听 | 持续监听，直到信道空闲再以p概率发送  |

  - CSMA/CD（碰撞**检测**）
    $$
    \frac{L}{v} \ge 2\tau
    $$
    帧长度范围`[64,1518]`

  - CSMA/CA（碰撞**避免**）

    - *发送方*：发送前检测信道是否空闲
    - *发送方*：空闲则发`RTS`，否则则等待
    - *接收方*：接受到`RTS`后，则响应`CTS`
    - *发送方*：接受到`CTS`后，开始发数据（同时预约信道）
    - *接收方*：接受到数据后，响应`ACK`

- 802.11的MAC帧头格式，注意四个地址

  - 地址1：接受端
  - 地址2：发送端
  - 地址3：目的地址
  - 地址4：源地址

- |     PPP协议      |     HDLC协议     |
  | :--------------: | :--------------: |
  |     面向字节     |     面向比特     |
  | 无序号和确认机制 | 有序号和确认机制 |
  |      不可靠      |       可靠       |

- 网桥

  - 透明网桥
  - 源路由网桥

- 交换机

  - 直通交换机：只需检查6B的目的地址就直接发走
  - 存储转发式交换机

## 网络层

- IGP动态路由算法

  - 全局性：链路状态算法OSPF
  - 分散性：距离向量算法RIP

- EGP外部网关协议：BGP

- 常用路由协议区分

  |      协议      |              RIP               |                 OSPF                 |                 BGP                  |
  | :------------: | :----------------------------: | :----------------------------------: | :----------------------------------: |
  |  **路由算法**  |            距离向量            |               链路状态               |               距离向量               |
  | **路由表内容** | 目的网络<br />下一条<br />距离 |    目的网络<br />下一条<br />距离    |        目的网络<br />完整路径        |
  |  **传递方式**  |              UDP               |                  IP                  |                 TCP                  |
  |    **策略**    |            跳数最少            |             费用代价最低             |                 多重                 |
  |  **交换结点**  |           相邻路由器           |              所有路由器              |              相邻路由器              |
  |  **交换内容**  |          自己的路由表          | 与本路由器相邻的所有路由器的链路状态 | 首次整个路由表<br />非首次，增量更新 |

- IP数据包分片

- 变长子网划分（可得到最小子网）：参考ABC三类IP地址划分

- ICMP

  - ICMP差错报文
    - 终点不可达
    - 源点抑制
    - 超时
    - 重定向
  - ICMP询问报文
    - 回送请求和回答（ping）

- IPv6

  - 首部固定40字节，且首部长度必须是8字节整数倍
  - 原地址，目的地址128位
  - IPv6只能在主机进行分片，而IPv4可以在主机和路由器分片
  - IPv6地址的写法，零压缩
    - 连续的`0000`可以用`0`表示
    - `0:0:0`可以用`::`表示

- 移动IP：移动结点以固定的网络IP地址，实现跨越不同网段的漫游功能

  - 移动结点：设备
  - 归属代理（本地代理）
  - 永久地址
  - 外部代理（外地代理）

- 路由器

  - 路由选择：根据**路由选择协议**和**路由表**进行处理
  - 分组转发：构建转发表，根据转发表转发

## 运输层

- TCP报文中的重要控制位
  - URG：紧急，不用排队，立刻发送
- 三次握手 
- 四次挥手
- 拥塞控制，慢启动，拥塞避免，快重传，快恢复

## 应用层

- DHCP，基于UDP协议，通过**广播**交互
  1. *主机*：“有咩有DHCP服务器？”
  2. *DHCP服务器*：“有有有！！！”
  3. *主机*：“我用你给我的IP？”
  4. *DHCP服务器*：“可以可以！！！” 
- SMTP的缺点（使用MIME解决）
  - 不可传送二进制 
  - 只能传送ASCII
  - 长度限制
- 读取邮件三种协议
  - POP3
  - IMAP
  - HTTP

